name: Build Corne Choc Pro firmware

on:
  workflow_dispatch:
  push:
    branches-ignore:
      - main
    paths:
      - 'boards/arm/corne_choc_pro/**'
      - 'config/corne_choc_pro.*'
      - 'build_corne.yaml'
      - 'config/west.yml'
      - 'zephyr/**'
    tags:
      - 'build'
permissions:
  contents: write

jobs:
  draw:
    name: Draw Corne Keymap
    uses: caksoylar/keymap-drawer/.github/workflows/draw-zmk.yml@main
    permissions:
      contents: read
    with:
      destination: artifact
      artifact_name: corne-keymap
      fail_on_error: true
      keymap_patterns: 'config/corne_choc_pro.keymap'
  build:
    name: Build Corne
    needs: draw
    uses: zmkfirmware/zmk/.github/workflows/build-user-config.yml@main
    with:
      build_matrix_path: build_corne.yaml
      archive_name: corne-firmware
